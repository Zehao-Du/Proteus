# å°†æœ¬åœ°ä¿®æ”¹åçš„ vllm é›†æˆåˆ°ä¸»ä»“åº“

## ğŸ¯ ç›®æ ‡

å°†æœ¬åœ°ä¿®æ”¹åçš„ `vllm` ä»£ç ç›´æ¥ä½œä¸ºé¡¹ç›®çš„ä¸€éƒ¨åˆ†æäº¤åˆ°åˆ†æ”¯ï¼Œè€Œä¸æ˜¯ä½œä¸º git submodule æˆ–å¤–éƒ¨ä¾èµ–ã€‚

## ğŸš€ æ–¹æ³• 1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x integrate_vllm.sh

# 2. è¿è¡Œè„šæœ¬
bash integrate_vllm.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… å¤‡ä»½ vllm ç›®å½•
- âœ… ç§»é™¤ vllm çš„ .gitï¼ˆå°†å…¶è½¬æ¢ä¸ºæ™®é€šç›®å½•ï¼‰
- âœ… æ›´æ–° .gitignoreï¼ˆå¦‚æœéœ€è¦ï¼‰
- âœ… æ·»åŠ  vllm åˆ°ä¸»ä»“åº“
- âœ… æäº¤æ›´æ”¹

## ğŸ”§ æ–¹æ³• 2: æ‰‹åŠ¨æ“ä½œ

### æ­¥éª¤ 1: ç§»é™¤ vllm çš„ç‹¬ç«‹ git ä»“åº“

```bash
# ç§»é™¤ vllm çš„ .git ç›®å½•
rm -rf vllm/.git

# å¯é€‰ï¼šç§»é™¤ vllm çš„ .gitignoreï¼ˆå¦‚æœä½ æƒ³ç”¨ä¸»ä»“åº“çš„è§„åˆ™ï¼‰
# rm -f vllm/.gitignore
```

### æ­¥éª¤ 2: æ›´æ–°ä¸»ä»“åº“çš„ .gitignore

æ£€æŸ¥ `.gitignore` æ˜¯å¦å¿½ç•¥äº† `vllm`ï¼š

```bash
# æŸ¥çœ‹ .gitignore
cat .gitignore | grep vllm

# å¦‚æœæœ‰ï¼Œéœ€è¦ç§»é™¤æˆ–æ³¨é‡Šæ‰
# ä¾‹å¦‚ï¼Œå¦‚æœæœ‰è¿™è¡Œï¼š
# vllm/
# éœ€è¦åˆ é™¤æˆ–æ³¨é‡Šæ‰
```

### æ­¥éª¤ 3: ä» git ä¸­ç§»é™¤æ—§çš„ vllm å¼•ç”¨

```bash
# å¦‚æœ vllm æ˜¯ä½œä¸º submodule æˆ–ç‰¹æ®Šå¼•ç”¨å­˜åœ¨çš„
git rm --cached vllm 2>/dev/null || true
```

### æ­¥éª¤ 4: æ·»åŠ  vllm åˆ°ä¸»ä»“åº“

```bash
# æ·»åŠ æ•´ä¸ª vllm ç›®å½•
git add vllm/

# æŸ¥çœ‹å°†è¦æäº¤çš„æ–‡ä»¶
git status vllm/
```

### æ­¥éª¤ 5: æäº¤æ›´æ”¹

```bash
# æäº¤
git commit -m "feat: é›†æˆæœ¬åœ°ä¿®æ”¹åçš„ vllm ä»£ç åˆ°ä¸»ä»“åº“

- ç§»é™¤ vllm çš„ç‹¬ç«‹ git ä»“åº“
- å°† vllm ä½œä¸ºé¡¹ç›®çš„ä¸€éƒ¨åˆ†ç›´æ¥æäº¤
- åŒ…å«æ‰€æœ‰æœ¬åœ°ä¿®æ”¹"
```

### æ­¥éª¤ 6: æ¨é€åˆ°è¿œç¨‹

```bash
# æ¨é€åˆ°ä½ çš„åˆ†æ”¯
git push origin <your-branch-name>
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶å¤§å°

vllm ç›®å½•å¯èƒ½å¾ˆå¤§ï¼Œç¡®ä¿ï¼š
- ä»“åº“æœ‰è¶³å¤Ÿçš„ç©ºé—´
- ç½‘ç»œè¿æ¥ç¨³å®šï¼ˆæ¨é€å¤§æ–‡ä»¶å¯èƒ½éœ€è¦æ—¶é—´ï¼‰

### 2. å¤‡ä»½

åœ¨æ“ä½œå‰å»ºè®®å¤‡ä»½ï¼š

```bash
# åˆ›å»ºå¤‡ä»½
cp -r vllm vllm_backup_$(date +%Y%m%d)
```

### 3. å¿½ç•¥ä¸å¿…è¦çš„æ–‡ä»¶

å¦‚æœ vllm ç›®å½•ä¸­æœ‰ä¸éœ€è¦æäº¤çš„æ–‡ä»¶ï¼ˆå¦‚ç¼–è¯‘äº§ç‰©ã€ç¼“å­˜ç­‰ï¼‰ï¼Œå¯ä»¥ï¼š

```bash
# åœ¨ .gitignore ä¸­æ·»åŠ 
echo "vllm/__pycache__/" >> .gitignore
echo "vllm/.deps/" >> .gitignore
echo "vllm/build/" >> .gitignore
# ... å…¶ä»–éœ€è¦å¿½ç•¥çš„ç›®å½•
```

### 4. å†å²è®°å½•

ç§»é™¤ `.git` åï¼Œvllm çš„ git å†å²ä¼šä¸¢å¤±ã€‚å¦‚æœä»¥åéœ€è¦ï¼š
- å¯ä»¥ä¿ç•™å¤‡ä»½ç›®å½•ä¸­çš„ `.git`
- æˆ–è€…ä½¿ç”¨ `git subtree` æ¥ä¿ç•™å†å²

## ğŸ”„ å¦‚æœå‡ºç°é—®é¢˜

### æ¢å¤å¤‡ä»½

```bash
# å¦‚æœæ“ä½œå‡ºé”™ï¼Œå¯ä»¥æ¢å¤
rm -rf vllm
mv vllm_backup_* vllm
```

### æ’¤é”€ git æ“ä½œ

```bash
# å¦‚æœå·²ç» add ä½†è¿˜æ²¡ commit
git reset HEAD vllm/

# å¦‚æœå·²ç» commit ä½†è¿˜æ²¡ push
git reset HEAD~1  # æ’¤é”€æœ€åä¸€æ¬¡æäº¤ï¼Œä¿ç•™æ–‡ä»¶ä¿®æ”¹
```

## ğŸ“Š éªŒè¯

æäº¤åéªŒè¯ï¼š

```bash
# æ£€æŸ¥ vllm æ˜¯å¦è¢«æ­£ç¡®è·Ÿè¸ª
git ls-files vllm/ | head -n 10

# æ£€æŸ¥æ–‡ä»¶å¤§å°
du -sh vllm/

# æ£€æŸ¥æäº¤å†å²
git log --oneline -1
```

## ğŸ¯ å®Œæ•´ç¤ºä¾‹

```bash
# 1. å¤‡ä»½
cp -r vllm vllm_backup

# 2. ç§»é™¤ vllm çš„ .git
rm -rf vllm/.git

# 3. æ›´æ–° .gitignoreï¼ˆå¦‚æœéœ€è¦ï¼‰
# ç¼–è¾‘ .gitignoreï¼Œç¡®ä¿æ²¡æœ‰å¿½ç•¥ vllm

# 4. ç§»é™¤æ—§çš„å¼•ç”¨
git rm --cached vllm 2>/dev/null || true

# 5. æ·»åŠ å¹¶æäº¤
git add vllm/
git commit -m "feat: é›†æˆæœ¬åœ°ä¿®æ”¹åçš„ vllm ä»£ç "

# 6. æ¨é€
git push origin <your-branch>
```

## ğŸ’¡ æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœä½ ä¸æƒ³å°†æ•´ä¸ª vllm æäº¤åˆ°ä»“åº“ï¼ˆå› ä¸ºæ–‡ä»¶å¤ªå¤§ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **åªæäº¤ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
   ```bash
   # åªæ·»åŠ ä½ ä¿®æ”¹çš„æ–‡ä»¶
   git add vllm/vllm/v1/core/sched/scheduler.py
   git add vllm/vllm/v1/engine/core.py
   # ... å…¶ä»–ä¿®æ”¹çš„æ–‡ä»¶
   ```

2. **ä½¿ç”¨ git subtree**ï¼ˆä¿ç•™å†å²ï¼‰ï¼š
   ```bash
   # å°† vllm ä½œä¸º subtree æ·»åŠ 
   git subtree add --prefix=vllm <vllm-repo-url> <branch> --squash
   ```

3. **ä½¿ç”¨ patch æ–‡ä»¶**ï¼š
   ```bash
   # ç”Ÿæˆ patch
   cd vllm
   git diff > ../vllm_changes.patch
   cd ..
   
   # æäº¤ patch æ–‡ä»¶
   git add vllm_changes.patch
   git commit -m "feat: vllm ä¿®æ”¹è¡¥ä¸"
   ```

---

**æ¨èä½¿ç”¨æ–¹æ³• 1ï¼ˆè‡ªåŠ¨åŒ–è„šæœ¬ï¼‰**ï¼Œå®ƒæ›´å®‰å…¨ä¸”åŒ…å«å¤‡ä»½åŠŸèƒ½ã€‚

